const lazyLoadedImages=document.querySelectorAll(".remove-lazy-cover .wp-block-cover__image-background");lazyLoadedImages&&lazyLoadedImages.forEach((t=>{t.removeAttribute("loading")}));const VERTICAL_JSON={TW:"Bike",FW:"Car",Life:"Life",Health:"Health"},LIMIT=9,SERVER=find_advisor_settings.fa_server_1,SERVER_2=find_advisor_settings.fa_server_2,API_KEY=find_advisor_settings.fa_api_key;async function getPincodeLocation(t){try{let e={"Content-Type":"application/json",APIkey:API_KEY},a=await fetch(SERVER+"/api/agent-locator/pin-details/"+t,{method:"GET",headers:e}),s=await a.json();if("failure"!=s.status)return sessionStorage.setItem("tm_pincode_data",JSON.stringify(s)),$("#pincode-filter-input").text(t),s;throw"Pincode not found"}catch(e){let a=sessionStorage.getItem("tm_vertical_data");return null!=a&&gtag("event","DPL-"+a+"-Message-Invalid-Pincode",{event_category:"DPL_Popup",event_label:"Pincode not found-"+t}),{error:!0,info:"Pincode not found",data:e}}}async function getAdvisorList(t,e,a=0,s=!1){try{0==parseInt(a)&&(window.tm_offset=0);let i={"Content-Type":"application/json",APIkey:API_KEY},o=JSON.stringify({pinCode:t,vertical:e}),n=await fetch(SERVER+"/api/agent-locator/advisors?offset="+a+"&limit=9",{method:"POST",body:o,headers:i}),r=await n.json();if(window.tm_total_advisor_count=r.totalEligibleAdvisorCount,window.tm_added_advisor_count=window.tm_added_advisor_count?window.tm_added_advisor_count+r.advisors.length:9*window.tm_offset+r.advisors.length,s)return r;r.advisors&&r.advisors.length>0?renderContent(r):renderEmptyScreen()}catch(t){if(s)return{error:!0,info:t};renderEmptyScreen()}}function renderContent(t){let e=document.getElementById("firstFoldList"),a=document.getElementById("lastFoldList"),s="",i="";t.advisors.slice(0,3).forEach((t=>{s+=`<div class="tm-advisor-wrap">\n        <div class="advisor-card">\n            <div class="advisor-card__wraper">\n                <a target="_blank" href="https://advisor.turtlemint.com/profile/${t.dpNo}/${t.partnerName}" class="tm-link tm-redirect" onclick="gtag('event', 'DPL-Partner_Website-Linkclicks', {event_category:'LinkClicks',event_label: 'Link-click Visit Website'});">Visit Website</a>\n                <div class="advisor-image">\n                    ${t.profilePicUrl?'<img src="'+SERVER_2+"/api/files/v1/view/"+t.profilePicUrl+'?broker=turtlemint" alt="'+VERTICAL_JSON[sessionStorage.getItem("tm_vertical_data")]+" Insurance advisor in "+t.city+'" onerror="this.style.display=\'none\'">':""}\n                </div>\n                <p class="tm-h2-bold advisor-name" title="${t.partnerName.toUpperCase()}">${t.partnerName}</p>\n                <p class="tm-body tm-grey-text advisor-location">${t.area}</p>\n                <div class="row tm-stats">\n                    <div class="stat">\n                        <p class="tm-h2-regular stat-title">${Math.floor(t.yearsOfExperience)} Years</p>\n                        <p class="tm-body tm-grey-text stat-subtitle">Experience</p>\n                    </div>\n                    <div class="stat">\n                        <p class="tm-h2-regular stat-title">${Math.floor(t.customersServed)}+</p>\n                        <p class="tm-body tm-grey-text stat-subtitle">Policies Sold</p>\n                    </div>\n                </div>\n                <a onclick="openPopup('getInTouchPopup', '${t.partnerName}', '${t.partnerId}')" class="tm-button">Get In Touch</a>\n                <br/>\n            </div>\n        </div>\n    </div>`})),t.advisors.length>3&&t.advisors.slice(3).forEach((t=>{i+=`<div class="tm-advisor-wrap">\n            <div class="advisor-card">\n                <div class="advisor-card__wraper">\n                    <a target="_blank" href="https://advisor.turtlemint.com/profile/${t.dpNo}/${t.partnerName}" class="tm-link tm-redirect" onclick="gtag('event', 'DPL-Partner_Website-Linkclicks', {event_category:'LinkClicks',event_label: 'Link-click Visit Website'});">Visit Website</a>\n                    <div class="advisor-image">\n                    ${t.profilePicUrl?'<img src="'+SERVER_2+"/api/files/v1/view/"+t.profilePicUrl+'?broker=turtlemint" alt="'+VERTICAL_JSON[sessionStorage.getItem("tm_vertical_data")]+" Insurance advisor in "+t.city+'" onerror="this.style.display=\'none\'">':""}\n                    </div>\n                    <p class="tm-h2-bold advisor-name" title="${t.partnerName.toUpperCase()}">${t.partnerName}</p>\n                    <p class="tm-body tm-grey-text advisor-location">${t.area}</p>\n                    <div class="row tm-stats">\n                        <div class="stat">\n                            <p class="tm-h2-regular stat-title">${Math.floor(t.yearsOfExperience)} Years</p>\n                            <p class="tm-body tm-grey-text stat-subtitle">Experience</p>\n                        </div>\n                        <div class="stat">\n                            <p class="tm-h2-regular stat-title">${Math.floor(t.customersServed)}+</p>\n                            <p class="tm-body tm-grey-text stat-subtitle">Policies Sold</p>\n                        </div>\n                    </div>\n                    <a onclick="openPopup('getInTouchPopup', '${t.partnerName}', '${t.partnerId}')" class="tm-button">Get In Touch</a>\n                    <br/>\n                </div>\n            </div>\n        </div>`})),e.innerHTML=s,a.innerHTML=t.advisors.length>3?i:"";let o=`${t.totalEligibleAdvisorCount?t.totalEligibleAdvisorCount:t.advisors.length} ${VERTICAL_JSON[sessionStorage.getItem("tm_vertical_data")]} Insurance Advisors`;$(".agent-count-js").text(o);let n=new URL(window.location);sessionStorage.getItem("tm_pincode_data")&&n.searchParams.set("pincode",JSON.parse(sessionStorage.getItem("tm_pincode_data")).pinCode),sessionStorage.getItem("tm_vertical_data")&&n.searchParams.set("vertical",sessionStorage.getItem("tm_vertical_data")),(window.tm_offset||0===window.tm_offset)&&n.searchParams.set("offset",window.tm_offset),window.history.pushState(null,"",n.toString()),$(".advisor-list-wraper").removeClass("d-none"),$("#empty-screen-wrap").addClass("d-none"),$("#pincodeForm .tm-button").removeClass("tm-loader"),populateVertical(),closePopup("pincodePopup"),$("#pincodeForm .filter-form-group").addClass("d-none"),$(".tm-loading").removeClass("tm-loading"),window.addEventListener("scroll",handleInfiniteScroll)}function renderEmptyScreen(){let t=new URL(window.location);sessionStorage.getItem("tm_pincode_data")&&t.searchParams.set("pincode",JSON.parse(sessionStorage.getItem("tm_pincode_data")).pinCode),sessionStorage.getItem("tm_vertical_data")&&t.searchParams.set("vertical",sessionStorage.getItem("tm_vertical_data")),(window.tm_offset||0===window.tm_offset)&&t.searchParams.set("offset",window.tm_offset),window.history.pushState(null,"",t.toString()),$(".advisor-list-wraper").addClass("d-none"),$("#empty-screen-wrap").removeClass("d-none"),gtag("event","No_DPL-"+sessionStorage.getItem("tm_vertical_data"),{event_category:"No_DPL-Page",event_label:"No_DPL-PV"}),$("#pincodeForm .tm-button").removeClass("tm-loader"),populateVertical(),closePopup("pincodePopup"),$(".tm-loading").removeClass("tm-loading")}function filterVertical(){$(".tm-preloader").addClass("tm-loading"),window.tm_added_advisor_count=0,getAdvisorList(JSON.parse(sessionStorage.getItem("tm_pincode_data")).pinCode,sessionStorage.getItem("tm_vertical_data"))}async function renderNextPage(){$("#paginationLoader").removeClass("d-none"),window.tm_offset=window.tm_offset+1;let t=await getAdvisorList(JSON.parse(sessionStorage.getItem("tm_pincode_data")).pinCode,sessionStorage.getItem("tm_vertical_data"),window.tm_offset,!0),e=document.getElementById("lastFoldList"),a="";t.advisors&&t.advisors.length>0&&t.advisors.forEach((t=>{a+=`<div class="tm-advisor-wrap">\n            <div class="advisor-card">\n                <div class="advisor-card__wraper">\n                    <a target="_blank" href="https://advisor.turtlemint.com/profile/${t.dpNo}/${t.partnerName}" class="tm-link tm-redirect" onclick="gtag('event', 'DPL-Partner_Website-Linkclicks', {event_category:'LinkClicks',event_label: 'Link-click Visit Website'});">Visit Website</a>\n                    <div class="advisor-image">\n                    ${t.profilePicUrl?'<img src="'+SERVER_2+"/api/files/v1/view/"+t.profilePicUrl+'?broker=turtlemint" alt="'+VERTICAL_JSON[sessionStorage.getItem("tm_vertical_data")]+" Insurance advisor in "+t.city+'" onerror="this.style.display=\'none\'">':""}\n                    </div>\n                    <p class="tm-h2-bold advisor-name" title="${t.partnerName.toUpperCase()}">${t.partnerName}</p>\n                    <p class="tm-body tm-grey-text advisor-location">${t.area}</p>\n                    <div class="row tm-stats">\n                        <div class="stat">\n                            <p class="tm-h2-regular stat-title">${Math.floor(t.yearsOfExperience)} Years</p>\n                            <p class="tm-body tm-grey-text stat-subtitle">Experience</p>\n                        </div>\n                        <div class="stat">\n                            <p class="tm-h2-regular stat-title">${Math.floor(t.customersServed)}+</p>\n                            <p class="tm-body tm-grey-text stat-subtitle">Policies Sold</p>\n                        </div>\n                    </div>\n                    <a onclick="openPopup('getInTouchPopup', '${t.partnerName}', '${t.partnerId}')" class="tm-button">Get In Touch</a>\n                    <br/>\n                </div>\n            </div>\n        </div>`}));let s=new URL(window.location);sessionStorage.getItem("tm_pincode_data")&&s.searchParams.set("pincode",JSON.parse(sessionStorage.getItem("tm_pincode_data")).pinCode),sessionStorage.getItem("tm_vertical_data")&&s.searchParams.set("vertical",sessionStorage.getItem("tm_vertical_data")),(window.tm_offset||0===window.tm_offset)&&s.searchParams.set("offset",window.tm_offset),window.history.pushState(null,"",s.toString()),$("#paginationLoader").addClass("d-none"),e.innerHTML+=a,window.addEventListener("scroll",handleInfiniteScroll)}async function handleInfiniteScroll(){let t=document.getElementById("lastFoldList");window.innerHeight+window.pageYOffset>=t.offsetTop+t.offsetHeight&&(removeInfiniteScroll(),await renderNextPage()),window.tm_total_advisor_count<=window.tm_added_advisor_count&&removeInfiniteScroll()}function removeInfiniteScroll(){window.removeEventListener("scroll",handleInfiniteScroll)}
